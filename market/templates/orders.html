{% extends 'market_base.html' %}
{% block title %}
    MyOrders
{% endblock %}
{% block body %}
    <div class="order-page-layout">
        {% if orders|length==0 %}
            <div style="color: rgb(255, 217, 0); text-align: center;">
                <h1>You have no orders made.</h1>
                <h2>Select a product in the products home page and click 'Make order'</h2>
            </div>
        {%else%}
            {% for i in range(orders|length) %}
                <div class="order-product">
                    <div style="order: 1;">
                        <img src="{{ url_for('static', filename=products[i].code+'.png' ) }}" class='product-page-img'>
                    </div>
                    <div style="order: 2" class='order-details'>
                        <div style="order: 1">
                            <h1 id="product-title">{{ products[i].title }}</h1>
                        </div>
                        <div style="order: 2" id='description-content'>
                            <i style="font-size: 1.15em; color: green;">Order code: </i>{{ orders[i].code }}
                        </div>
                        <div style="order: 3" id='description-content'>
                            <i style="font-size: 1.15em; color: green;">Time made: </i><b style="color: red;">{{ orders[i].time }}</b>
                        </div>
                        <div style="order: 4" id='description-content'>
                            <br>
                            <i style="font-size: 1.15em; color: green;">Address: </i><address>{{ orders[i].address }}</address>
                        </div>
                        <div style="order: 5" id='description-content'>
                            <br>
                            <i style="font-size: 1.15em; color: green;">County: </i>{{ orders[i].county }}
                        </div>
                        <div style="order: 6" id='description-content'>
                            <br>
                            <i style="font-size: 1.15em; color: green;">Town: </i>{{ orders[i].town }}
                        </div>
                        <div style="order: 7" id='description-content'>
                            <br>
                            <i style="font-size: 1.15em; color: green;">Number of Items: </i>{{ orders[i].numberOfItems }}
                        </div>
                        <div style="order: 8" id='description-content'>
                            <br>
                            <i style="font-size: 1.15em; color: green;">Total payable: </i>Ksh {{ products[i].price*orders[i].numberOfItems }}
                        </div>
                    </div>
                    <div class="actions-on-product" style="order: 3">
                        <div style="order:1">
                            <a class="actions-on-product-submit" href="{{ url_for('order_page', order_code_to_cancel=orders[i].code, product_code_to_cancel=products[i].code) }}">Cancel order</a>
                        </div>
                        <div style="order:2">
                            <button  class="actions-on-product-submit" onclick="openForm( '{{ orders[i].code }}' )" name="{{ orders[i].code }}"><b>Change Order details</b></button>
                            <div class="form-popup" id="{{ orders[i].code }}">
                                <form class="form-container" method="POST" action="{{ url_for('order_page', order_code_to_cancel='none', product_code_to_cancel='none', order_code_to_change=orders[i].code) }}">
                                {{ orderForm.hidden_tag() }}
                                <h1>ORDER DETAILS</h1>

                                {{ orderForm.address.label() }}
                                {{ orderForm.address(placeholder='Enter address for delivery', value=orders[i].address) }}             
                                
                                {{ orderForm.county.label() }}
                                {{ orderForm.county(placeholder='County for delivery', value=orders[i].county) }}
                                
                                {{ orderForm.town.label() }}
                                {{ orderForm.town(placeholder='Town for delivery', value=orders[i].town) }}
                                
                                {{ orderForm.numberOfItems.label() }}
                                {{ orderForm.numberOfItems(placeholder='Number of items to order', min=1, max=products[i].numberOfItems, value=orders[i].numberOfItems) }}
                            
                                {{ orderForm.submit2(class='btn', value='Change Order '+orders[i].code) }}
                                <button type="button" class="btn cancel" onclick="closeForm('{{ orders[i].code }}')">Close</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            {%endfor%}
        {% endif %}
    </div>

    <style>       
        /* The popup form - hidden by default */
        .form-popup {
          display: none;
          position:fixed;
          top: 40px;
          right: 15px;
          border: 3px solid #f1f1f1;
          z-index: 9;
        }
        
        /* Add styles to the form container */
        .form-container {
          max-width: 400px;
          padding: 10px;
          background-color: white;
        }
        
        /* Full-width input fields */
        .form-container input[type=text], .form-container input[type=password], .form-container input[type=number] {
          width: 100%;
          padding: 15px;
          margin: 5px 0 22px 0;
          border: none;
          background: #f1f1f1;
        }
        
        /* When the inputs get focus, do something */
        .form-container input[type=text]:focus, .form-container input[type=password]:focus {
          background-color: #ddd;
          outline: none;
        }
        
        /* Set a style for the submit/login button */
        .form-container .btn {
          background-color: rgb(255, 217, 0);
          color: black;
          font-weight: 900;
          padding: 16px 20px;
          border: none;
          cursor: pointer;
          width: 100%;
          margin-bottom:10px;
          opacity: 0.8;
        }
        
        /* Add a red background color to the cancel button */
        .form-container .cancel {
          background-color: red;
        }
        
        /* Add some hover effects to buttons */
        .form-container .btn:hover{
          opacity: 1;
        }
    </style>
    <script>
        function openForm(id) {
          document.getElementById(id).style.display = "block";
        }
        
        function closeForm(id) {
          document.getElementById(id).style.display = "none";
        }
    </script>
{% endblock %}
</html>